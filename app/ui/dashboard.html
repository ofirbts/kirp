import streamlit as st
from app.core.metrics import Metrics
from app.core.observability import Observability
from app.core.tenant import TenantContext

st.set_page_config(page_title="KIRP Control Plane", layout="wide")

st.markdown("""
## ğŸš€ KIRP Enterprise Control Plane
**Governed Intelligence â€¢ Memory â€¢ Observability**
""")

# Sidebar
st.sidebar.markdown("## ğŸ§© Tenant Control")
tenant = st.sidebar.selectbox(
    "Active Tenant",
    ["default", "demo", "enterprise"]
)
TenantContext.set(tenant)
st.sidebar.success(f"ğŸŸ¢ Active: {tenant}")

metrics = Metrics.snapshot()
obs = Observability.snapshot()

c1, c2, c3, c4 = st.columns(4)
c1.metric("ğŸŸ¢ System Health", "OK")
c2.metric("ğŸ§  Queries", metrics.get("qps", 0))
c3.metric("ğŸ“ˆ Drift", f"{obs.get('drift', 0)}%")
c4.metric("ğŸ’¾ Memory (MB)", obs.get("memory_mb", 0))

st.markdown("### ğŸ§  Agent State")
st.json(obs.get("agent_state", {}))
